"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const create_elements_1 = require("@toolkip/create-elements");
function loadFile(fileDetails) {
    return new Promise((resolve, reject) => {
        this._innerLoadFile(fileDetails, resolve, reject);
    });
}
exports.loadFile = loadFile;
function _innerLoadFile(fileDetails, success, error) {
    let request = new XMLHttpRequest();
    request.open('GET', fileDetails.filename);
    request.onreadystatechange = () => {
        if (request.readyState == 4 && request.status == 200) {
            success(request.responseText);
        }
        else if (request.status === 404) {
            error(request.responseText);
        }
    };
    request.send();
}
exports._innerLoadFile = _innerLoadFile;
;
function saveFile(fileDetails) {
    return new Promise((resolve) => {
        _innerSaveFile(fileDetails, resolve);
    });
}
exports.saveFile = saveFile;
function _innerSaveFile({ filename, content }, resolve) {
    let blob;
    if (typeof content === "string") {
        blob = new Blob([content], { type: "text/plain" });
    }
    else {
        blob = content;
    }
    _generateDownload(filename, blob);
}
function _generateDownload(filename, file) {
    if (window.navigator.msSaveOrOpenBlob) {
        window.navigator.msSaveBlob(file, "u");
    }
    else {
        let elem = create_elements_1.createElement({
            type: "a",
            attr: {
                "href": window.URL.createObjectURL(file),
                "download": filename
            }
        });
        document.body.appendChild(elem);
        elem.click();
        document.body.removeChild(elem);
    }
}
